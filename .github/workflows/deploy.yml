name: Deploy to GitHub Pages

on:
  push:
    branches:
      - master

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.USER_TOKEN }}

    - name: Set up Git
      run: |
        git config --global user.name "Arch Warden"
        git config --global user.email "tombos255+archwarden@gmail.com"
    
    - name: Ensure the build branch exists
      run: |
        git fetch origin
        git checkout build

    - name: Install Make
      run: sudo apt-get install make

    - name: Build project
      run: make build

    - name: Make deploy
      run: make deploy

    - name: Show Files
      run: ls -la

    - name: Shows Files 2
      run: ls -la src/
    
    - name: Commit changes
      run: |
        git add .
        git commit -m "Deploy to GitHub Pages" || echo "No changes to commit"

    - name: Push to build branch
      run: |
        git push --all -f https://x-access-token:${{ secrets.USER_TOKEN }}@github.com/${{ github.repository }}.git
