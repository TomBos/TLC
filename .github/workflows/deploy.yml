name: Deploy to GitHub Pages

on:
  push:
    branches:
      - master

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: â¬‡ï¸ Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.USER_TOKEN }}

      - name: ğŸ› ï¸ Set up Git
        run: |
          git config --global user.name "Arch Warden"
          git config --global user.email "tombos255+archwarden@gmail.com"
      
      - name: ğŸ”„ Ensure new data
        run: |
          git fetch
          git checkout master
          git pull
      
      - name: ğŸ§¹ Clear local build branch
        run: |
          git checkout build 
          rm -f TLC.sh
          rm -f index.html
          git checkout master


      - name: âš™ï¸ Install Make
        run: sudo apt-get install make

      - name: ğŸ—ï¸ Build project
        run: make build

      - name: ğŸš€ Make deploy
        run: make deploy

      - name: ğŸ—‚ï¸ Stash Files
        run: git stash

      - name: ğŸ”„ Checkout to build and pop stash
        run: |
          git checkout build
          git stash pop

      - name: âœ… Commit changes
        run: |
          git add .
          git commit -m "Deploy to GitHub Pages" || echo "No changes to commit"

      - name: â¬†ï¸ Push to build branch
        run: |
          git push --all -f https://x-access-token:${{ secrets.USER_TOKEN }}@github.com/${{ github.repository }}.git

